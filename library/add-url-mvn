#!/usr/bin/python
# -*- coding: utf-8 -*-

import os
import re


def main():
    module = AnsibleModule(
        argument_spec = dict(
            dest = dict(required=True),
            search_string = dict(required=True),
            add_url = dict(required=True),
        ),
        supports_check_mode=True,
    )

    f = open(module.params['dest'], 'r+')
    lines = f.readlines()
    f.seek(0)
    i = 0
    filelines = ''
    q = ''
    for line in lines:
        i = i + 1
        if line.find(module.params['search_string']) != -1:
            changed = True
            break
        else:
            filelines = filelines + line
            changed = False
#    f.truncate()
#    f.close()

    if changed == True:
        filelines = filelines + module.params['search_string'] + ' \\' + '\n'
        for url in module.params[ 'add_url']:
            filelines = filelines + '\t' + url + ' \\' + '\n'
        b = re.compile(r"\d+\.\d*")
        # f.writelines(filelines)
        # f.close()
        # changed = True

    module.exit_json(changed=changed, msg=filelines)

# import module snippets
from ansible.module_utils.basic import *
main()

